<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CONTROL DE PRODUCTOS</title>
</head>
<body>
    <h2>Registrar Producto</h2>
    <form id="formularioRegistro">
        <input type="text" id="nombre" placeholder="Nombre" required><br><br>
        <input type="text" id="descripcion" placeholder="Descripcion" required><br><br>
        <input type="number" step="0.01" id="precio" placeholder="Precio" required><br><br>
        <button type="submit">Registrar Producto</button>
    </form>
    <br>

    <h2>Actualizar Producto</h2>
    <form id="formularioActualizacion">
        <input type="number" id="Actualizar_id_producto" placeholder="Id Producto" required><br><br>
        <input type="text" id="ActualizarNombre" placeholder="Nuevo Nombre" required><br><br>
        <input type="text" id="ActualizarDescripcion" placeholder="Nueva Descripcion" required><br><br>
        <input type="number" step="0.01" id="ActualizarPrecio" placeholder="Nuevo Precio" required><br><br>
        <button type="submit">Actualizar Producto</button>
    </form>
    <br>

    <h2>Eliminar Producto</h2>
    <form id="formularioEliminacion">
        <input type="number" id="id_eliminar" placeholder="Id Producto" required><br><br>
        <button type="submit">Eliminar Producto</button>
    </form>
    <br>

    <h2>Lista de Productos</h2>
    <button onclick="listarProductos()">Cargar / Actualizar Lista</button><br><br>
    <table id="tablaProductos" border="1">
        <thead>
            <tr>
                <th>Id</th>
                <th>Nombre</th>
                <th>Descripci√≥n</th>
                <th>Precio</th>
                <th>Fecha</th>
            </tr>
        </thead>
        <tbody id="cuerpoTabla"></tbody>
    </table>

    <script>

        document.getElementById('formularioRegistro').addEventListener('submit', async (e) => {
            e.preventDefault();
            const datos = {
                nombre: document.getElementById('nombre').value,
                descripcion: document.getElementById('descripcion').value,
                precio: document.getElementById('precio').value
            };
            const res = await fetch(`http://localhost:3000/registrar`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(datos)
            });
            const result = await res.json();
            alert(result.message || result.error);
            listarProductos();
        });

        document.getElementById('formularioActualizacion').addEventListener('submit', async (e) => {
            e.preventDefault();
            const datos = {
                id_producto: document.getElementById('Actualizar_id_producto').value,
                nombre: document.getElementById('ActualizarNombre').value,
                descripcion: document.getElementById('ActualizarDescripcion').value,
                precio: document.getElementById('ActualizarPrecio').value
            };
            const res = await fetch(`http://localhost:3000/actualizar`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify(datos)
            });
            const result = await res.json();
            alert(result.message || result.error);
            listarProductos();
        });

        document.getElementById('formularioEliminacion').addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('id_eliminar').value;
            const res = await fetch(`http://localhost:3000/eliminar`, {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ id_producto: id })
            });
            const result = await res.json();
            alert(result.message || result.error);
            listarProductos();
        });

        async function listarProductos() {
            const res = await fetch(`http://localhost:3000/listar`);
            const productos = await res.json();
            const cuerpo = document.getElementById('cuerpoTabla');
            cuerpo.innerHTML = '';

            productos.forEach(p => {
                cuerpo.innerHTML += `
                    <tr>
                        <td>${p.id_producto}</td>
                        <td>${p.nombre}</td>
                        <td>${p.descripcion}</td>
                        <td>${p.precio}</td>
                        <td>${p.fecha_registro}</td>
                    </tr>
                `;
            });
        }

        listarProductos();
    </script>
</body>
</html>